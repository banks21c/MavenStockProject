package html.parsing.stock.javafx;

import java.io.IOException;
import java.lang.reflect.Field;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.net.CookieHandler;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import java.util.logging.Level;

import javax.swing.JOptionPane;

import org.apache.commons.lang.StringUtils;
import org.json.JSONArray;
import org.json.JSONObject;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.sun.webkit.network.CookieManager;

import html.parsing.stock.model.StockVO;
import html.parsing.stock.news.NewsPublisher;
import html.parsing.stock.util.FileUtil;
import html.parsing.stock.util.NaverUtil;
import javafx.application.Application;
import javafx.concurrent.Worker;
import javafx.event.EventHandler;
import javafx.geometry.Orientation;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.ComboBox;
import javafx.scene.control.Label;
import javafx.scene.control.Separator;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;
import javafx.scene.input.KeyCode;
import javafx.scene.layout.HBox;
import javafx.scene.layout.VBox;
import javafx.scene.text.Font;
import javafx.scene.text.Text;
import javafx.scene.web.WebEngine;
import javafx.scene.web.WebView;
import javafx.stage.Stage;

public class JavaFxNewsReaderNaverLinkShare extends Application {

	final static String userHome = System.getProperty("user.home");
	private static Logger logger = LoggerFactory.getLogger(JavaFxNewsReaderNaverLinkShare.class);

	List<StockVO> kospiUniqueStockList = new ArrayList<>();
	List<StockVO> kosdaqUniqueStockList = new ArrayList<>();

	WebEngine webengine = null;

	String strNidAut = "";
	String strNidSes = "";

	TextField nidAutTf = new TextField();
	TextArea nidSesTa = new TextArea();
	Text shareResultTxt = new Text();

	ComboBox<String> categoryListComboBox = new ComboBox<String>();

	public static void main(String[] args) {
		launch(args);
	}

	public void start(Stage primaryStage) {
		primaryStage.setTitle("ÏóîÏ†§ Î∏åÎùºÏö∞Ï†Ä");
		final String FONT_FAMILY = "Arial"; // define font family you need
		final double MAX_FONT_SIZE = 20.0; // define max font size you need
		final String FX_FONT_STYLE = "-fx-font-family: 'Arial';-fx-font-size: 20px;-fx-font-weight: bold;";

		Separator vSeparator = new Separator();
		vSeparator.setOrientation(Orientation.VERTICAL);
		vSeparator.setPrefHeight(10);

		Separator hSeparator = new Separator();
		hSeparator.setOrientation(Orientation.HORIZONTAL);
		hSeparator.setPrefWidth(10);

		// Top
		Text homeTxt = new Text("üè†");
		homeTxt.setStyle(FX_FONT_STYLE);
//		Text backTxt = new Text("‚Üê");üè†
		Text backTxt = new Text("‚á¶");
		backTxt.setStyle(FX_FONT_STYLE);
//		Text forwardTxt = new Text("‚Üí");
		Text forwardTxt = new Text("‚á®");
//		Text forwardTxt = new Text("‚û≤");
		forwardTxt.setStyle(FX_FONT_STYLE);
		Text reloadTxt = new Text("‚ü≥");
		reloadTxt.setStyle(FX_FONT_STYLE);

		Label backLbl = new Label("‚Üê");
		backLbl.setPrefWidth(50);
		backLbl.setPrefHeight(25);
		backLbl.setAlignment(Pos.TOP_LEFT);
		backLbl.setFont(new Font(FONT_FAMILY, MAX_FONT_SIZE)); // set to Label		

		Label forwardLbl = new Label("‚Üí");
		forwardLbl.setPrefWidth(50);
		forwardLbl.setPrefHeight(25);
		forwardLbl.setAlignment(Pos.TOP_LEFT);
		forwardLbl.setFont(new Font(FONT_FAMILY, MAX_FONT_SIZE)); // set to Label		

		Label reloadLbl = new Label("‚ü≥");
		reloadLbl.setPrefWidth(50);
		reloadLbl.setPrefHeight(25);
		reloadLbl.setAlignment(Pos.TOP_LEFT);
		reloadLbl.setFont(new Font(FONT_FAMILY, MAX_FONT_SIZE)); // set to Label		

		TextField urlTf = new TextField();
		urlTf.setPrefWidth(800);
		urlTf.setPrefHeight(25);
		urlTf.setAlignment(Pos.TOP_LEFT);

		urlTf.addEventHandler(javafx.scene.input.KeyEvent.KEY_PRESSED,
			new EventHandler<javafx.scene.input.KeyEvent>() { // Was missing the <MouseEvent>
			@Override
			public void handle(javafx.scene.input.KeyEvent event) {
				System.out.println("code:" + event.getCode());
				System.out.println("code:" + event.getText());
				System.out.println("code:" + event.getCharacter());
				System.out.println("KeyCode.ENTER:" + KeyCode.ENTER);
				System.out.println("event.getCode().equals(KeyCode.ENTER):" + event.getCode().equals(KeyCode.ENTER));
				if (event.getCode().equals(KeyCode.ENTER)) {
					String url = urlTf.getText();
					System.out.println("url1:" + url);
					if (!url.toLowerCase().startsWith("http") && !url.toLowerCase().startsWith("https")) {
						if (!url.contains(".") || url.contains(" ")) {
							url = "https://www.google.com/search?q=" + url + "&oq=" + url;
						} else {
							url = "http://" + url;
						}
					}
					System.out.println("url2:" + url);
					webengine.load(url);
				}
			}
		});

		urlTf.textProperty().addListener((observable, oldValue, newValue) -> {
			System.out.println("textfield changed from " + oldValue + " to " + newValue);
			getNaverCookies();
		});

		Button goBtn = new Button("GO");
		goBtn.addEventHandler(javafx.scene.input.MouseEvent.MOUSE_CLICKED,
			new EventHandler<javafx.scene.input.MouseEvent>() { // Was missing the <MouseEvent>
			@Override
			public void handle(javafx.scene.input.MouseEvent event) {
				String url = urlTf.getText();
				System.out.println("url1:" + url);
					if (!url.toLowerCase().startsWith("http") && !url.toLowerCase().startsWith("https")) {
						if (!url.contains(".") || url.contains(" ")) {
							url = "https://www.google.com/search?q=" + url + "&oq=" + url;
						} else {
							url = "http://" + url;
						}
					}
				System.out.println("url2:" + url);
				webengine.load(url);
			}
		});

		Button shareBtn = new Button("ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í∏ÄÏì∞Í∏∞");

		shareBtn.setOnMouseReleased(new EventHandler<javafx.scene.input.MouseEvent>() {
			@Override
			public void handle(javafx.scene.input.MouseEvent event) {
				shareResultTxt.setText("...");
			}

		});

		shareBtn.setOnMouseClicked(new EventHandler<javafx.scene.input.MouseEvent>() {
			@Override
			public void handle(javafx.scene.input.MouseEvent event) {
				shareResultTxt.setText("...");
				//ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í≥µÏú†
				System.out.println("ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í∏ÄÏì∞Í∏∞");
				getNaverCookies();
				logger.debug("strNidAut :" + strNidAut);
				logger.debug("strNidSes :" + strNidSes);
				if (!strNidAut.equals("") && !strNidSes.equals("")) {

					String url = urlTf.getText();
					System.out.println("url1:" + url);
					if (!url.toLowerCase().startsWith("http") && !url.toLowerCase().startsWith("https")) {
						if (!url.contains(".") || url.contains(" ")) {
							url = "https://www.google.com/search?q=" + url + "&oq=" + url;
						} else {
							url = "http://" + url;
						}
					}
					System.out.println("url2:" + url);
					createHTMLFile(url);
				} else {
					JOptionPane.showMessageDialog(null, "Î®ºÏ†Ä ÎÑ§Ïù¥Î≤ÑÏóê Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.");
					return;
				}

			}

		});

//		shareBtn.addEventHandler(javafx.scene.input.MouseEvent.MOUSE_CLICKED,
//			new EventHandler<javafx.scene.input.MouseEvent>() { // Was missing the <MouseEvent>
//			@Override
//			public void handle(javafx.scene.input.MouseEvent event) {
//				//ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í≥µÏú†
//				System.out.println("ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ Í∏ÄÏì∞Í∏∞");
//				getNaverCookies();
//				logger.debug("strNidAut :" + strNidAut);
//				logger.debug("strNidSes :" + strNidSes);
//				if (!strNidAut.equals("") && !strNidSes.equals("")) {
//
//					String url = urlTf.getText();
//					System.out.println("url1:" + url);
//					if (!url.toLowerCase().startsWith("http") && !url.toLowerCase().startsWith("https")) {
//						if (!url.contains(".") || url.contains(" ")) {
//							url = "https://www.google.com/search?q=" + url + "&oq=" + url;
//						} else {
//							url = "http://" + url;
//						}
//					}
//					System.out.println("url2:" + url);
//					createHTMLFile(url);
//				} else {
//					JOptionPane.showMessageDialog(null, "Î®ºÏ†Ä ÎÑ§Ïù¥Î≤ÑÏóê Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.");
//					return;
//				}
//
//			}
//		});
//		HBox urlHBox = new HBox(backLbl, forwardLbl, reloadLbl, urlTf, goBtn);
		HBox urlHBox = new HBox(10);
		urlHBox.getChildren().addAll(homeTxt);
		urlHBox.getChildren().addAll(hSeparator);
		urlHBox.getChildren().addAll(backTxt);
		urlHBox.getChildren().addAll(forwardTxt);
		urlHBox.getChildren().addAll(reloadTxt);
		urlHBox.getChildren().addAll(urlTf);
		urlHBox.getChildren().addAll(goBtn);
		urlHBox.getChildren().addAll(shareBtn);
		urlHBox.getChildren().addAll(shareResultTxt);

		WebView webView = new WebView();
		webengine = webView.getEngine();

//		webengine.load("https://finance.daum.net/domestic/all_quotes");
		webengine.load("https://www.naver.com");
		webengine.getLoadWorker().stateProperty().addListener((observable, oldValue, newValue) -> {
			if (Worker.State.SUCCEEDED.equals(newValue)) {
				urlTf.setText(webengine.getLocation());
			}
		});

		homeTxt.addEventHandler(javafx.scene.input.MouseEvent.MOUSE_CLICKED,
			new EventHandler<javafx.scene.input.MouseEvent>() { // Was missing the <MouseEvent>
			@Override
			public void handle(javafx.scene.input.MouseEvent event) {
				webView.getEngine().load("https://www.naver.com");
			}
		});
		backTxt.addEventHandler(javafx.scene.input.MouseEvent.MOUSE_CLICKED,
			new EventHandler<javafx.scene.input.MouseEvent>() { // Was missing the <MouseEvent>
			@Override
			public void handle(javafx.scene.input.MouseEvent event) {
				webView.getEngine().getHistory().go(-1);
			}
		});
		forwardTxt.addEventHandler(javafx.scene.input.MouseEvent.MOUSE_CLICKED,
			new EventHandler<javafx.scene.input.MouseEvent>() { // Was missing the <MouseEvent>
			@Override
			public void handle(javafx.scene.input.MouseEvent event) {
				webView.getEngine().getHistory().go(1);
			}
		});
		reloadTxt.addEventHandler(javafx.scene.input.MouseEvent.MOUSE_CLICKED,
			new EventHandler<javafx.scene.input.MouseEvent>() { // Was missing the <MouseEvent>
			@Override
			public void handle(javafx.scene.input.MouseEvent event) {
				webView.getEngine().reload();
			}
		});

		Button saveBtn = new Button("Save");
		saveBtn.addEventHandler(javafx.scene.input.MouseEvent.MOUSE_CLICKED,
			new EventHandler<javafx.scene.input.MouseEvent>() { // Was missing the <MouseEvent>
			@Override
			public void handle(javafx.scene.input.MouseEvent event) {
				String html = (String) webView.getEngine().executeScript("document.documentElement.outerHTML");

				System.out.println("html:" + html);
				//saveHtml(html, "Ï†ÑÍ¥ëÌåê");
				try {
					saveCookies();
				} catch (NoSuchMethodException ex) {
					java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
				} catch (InvocationTargetException ex) {
					java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
				} catch (IllegalAccessException ex) {
					java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
				} catch (NoSuchFieldException ex) {
					java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
				} catch (ClassNotFoundException ex) {
					java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
				} catch (IOException ex) {
					java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
				}
			}
		;
		});
		
		Text nidAutTxt = new Text("NID_AUT");
		nidAutTxt.setStyle(FX_FONT_STYLE);

		nidAutTf = new TextField();
		nidAutTf.setPrefWidth(800);
		nidAutTf.setPrefHeight(25);
		nidAutTf.setAlignment(Pos.TOP_LEFT);
		HBox nidAutBox = new HBox(nidAutTxt, nidAutTf);

		Text nidSesTxt = new Text("NID_SES");
		nidSesTxt.setStyle(FX_FONT_STYLE);

		nidSesTa = new TextArea();
		nidSesTa.setPrefWidth(800);
		nidSesTa.setPrefHeight(125);
		nidSesTa.setWrapText(true);

		categoryListComboBox.getItems().addAll(
			"266:Ïø†Ìå° ÏÉÅÌíà Ï∂îÏ≤ú", "267:Î°úÏºìÎ∞∞ÏÜ°", "268:Î°úÏºìÌîÑÎ†àÏãú", "269:Î°úÏºìÏßÅÍµ¨", "270:Ï†ïÍ∏∞Î∞∞ÏÜ°", "271:Í≥®ÎìúÎ∞ïÏä§", "272:Í∏∞ÌöçÏ†Ñ", "274:Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Î≤†Ïä§Ìä∏ ÏÉÅÌíà", "275:PL ÏÉÅÌíà", "276:PL Î∏åÎûúÎìúÎ≥Ñ ÏÉÅÌíà", "277:Ï∂îÏ≤ú ÏÉÅÌíà", "33:ÏÜåÍ∞ú, ÏïåÎ¶º, Í≥µÏßÄ", "173:Ïú†Ìñâ, Ìä∏Î†åÎìú, ÎèôÌñ•", "255:Ïó≠ÏÇ¨", "88:ÏÇ¨Ìöå, Î¨∏Ìôî", "198:Íµ≠Ï†ïÍµêÍ≥ºÏÑú", "216:ÌòºÏù¥ÎπÑÏ†ïÏÉÅ", "31:Ï†ïÏπò, Ï†ïÎ∂Ä, Ï†ïÏ±Ö", "180:ÏÑ†Í±∞", "7:Íµ≠Ïô∏, Ìï¥Ïô∏, Íµ≠Ï†ú, ÏÑ∏Í≥Ñ", "249:Î∂ÅÌïú", "236:ÎØ∏Íµ≠", "228:Ï§ëÍµ≠", "237:ÏùºÎ≥∏", "2:Í≤ΩÏ†ú, ÏÇ∞ÏóÖ", "256:ÏÇºÏÑ±", "260:ÌòÑÎåÄ", "141:Î∂ÄÎèôÏÇ∞", "238:Í∞ÄÏÉÅ(ÏïîÌò∏)ÌôîÌèê", "250:Ìà¨ÏûêÏç∞Ï†Ñ", "47:IT(Info Tech)", "258:BT(Bio Tech)", "259:NT(Nano Tech)", "199:Ïπ¥ÌéòÎ≤†ÎÑ§", "131:Ï¶ùÍ∂å", "265:ÎØ∏Íµ≠", "146:Ï¶ùÍ∂å‚Üë‚Üì‚Üó‚Üò", "153:ÌäπÏßïÏ£º", "164:Ïã†Í≥†, Ïã†Ï†ÄÍ∞Ä", "235:ÏãúÍ∞ÑÏô∏Îã®ÏùºÍ∞Ä", "278:Ï¶ùÍ∂åÎâ¥Ïä§", "176:Ï†úÏïΩ,ÏïΩÌíà, Î∞îÏù¥Ïò§", "264:IT(Info Tech)", "273:Ï°∞ÏÑ†", "190:ÏÇºÏÑ±Ï£º", "171:Íµ≠ÎØºÏó∞Í∏à", "261:ETN, ETF", "188:Ìï∏ÎîîÏÜåÌîÑÌä∏", "253:Entertainment", "166:Ïô∏Íµ≠Ïù∏ Î≥¥Ïú†", "170:PER", "172:ÏÉÅÌïòÌïúÏùºÏàò", "148:Îç∞Ïù¥ÌÉÄ", "155:Top 100", "159:Í∏∞Ïô∏ Ïó∞ÏÜçÎß§Ïàò", "160:Í∏∞Ïô∏ Ïó∞ÏÜçÎß§ÎèÑ", "156:Í∏∞Ïô∏ Í±∞ÎûòÎüâ", "161:Í∏∞Ïô∏ Í±∞ÎûòÎåÄÍ∏à", "157:Í∏∞Ïô∏ ÏñëÎß§ÏàòÍ∏à", "162:Í∏∞Ïô∏ ÏñëÎß§ÏàòÎüâ", "158:Í∏∞Ïô∏ ÏñëÎß§ÎèÑÍ∏à", "163:Í∏∞Ïô∏ ÏñëÎß§ÎèÑÎüâ", "152:Í∏∞ÌöçÍ∏∞ÏÇ¨", "209:Î∞©ÏÜ°, Ïñ∏Î°†", "210:JTBC", "201:Îâ¥Ïä§Í≥µÏû•", "202:ÌååÌååÏù¥Ïä§", "206:Ïä§Ìè¨Ìä∏ÎùºÏù¥Ìä∏", "150:Í±¥Í∞ï", "207:ÏπòÎß§", "29:ÎπÑÌÉÄÎØº", "140:Ïö¥Îèô", "151:ÏãùÎãπ", "208:ÎßàÏïΩ", "263:ÏßàÎ≥ë", "132:Manuka Honey", "9:ÏùåÏãù, ÏãùÎ£åÌíà", "262:ÌôòÍ≤Ω", "142:ÏÇ¨Í±¥, ÏÇ¨Í≥†", "182:ÏÑ∏ÏõîÌò∏", "234:4ÎåÄÍ∞ï", "204:5Ï¥åÏÇ¥Ïù∏ÏÇ¨Í±¥", "241:MeToo", "243:Í∞ëÏßà", "244:ÎåìÍ∏ÄÏÇ¨Í±¥", "121:Ïò§ÎäòÏùò Ïû†Ïñ∏", "177:Ïò§ÎäòÏùò Í≥ÑÏãú", "128:Ïò§ÎäòÏùò ÏÑ±Í≤Ω", "120:Ïò§ÎäòÏùò ÎßêÏîÄ", "149:Ïò§ÎäòÏùò ÏÇ¨ÏßÑ", "123:Ïò§ÎäòÏùò ÏòÅÏñ¥", "178:Ï£ºÏùº, ÏàòÏöîÎßêÏîÄ", "245:Ïù∏Î¨º", "197:Î¨∏Ïû¨Ïù∏ÎåÄÌÜµÎ†π", "189:ÎÖ∏Î¨¥ÌòÑÎåÄÌÜµÎ†π", "225:Ïù∏Î¨º1", "179:Ïù¥ÏäπÎßå", "183:Î∞ïÏ†ïÌù¨", "240:Ïù¥Î™ÖÎ∞ï", "185:Î∞ïÍ∑ºÌòú", "193:Ïù¥Ïû¨Î™Ö", "191:ÍπÄÍ∏∞Ï∂ò", "186:ÏµúÌÉúÎØº", "200:ÍπÄÏû¨Í∑ú", "184:ÏµúÏàúÏã§", "229:Ïû•Ï§ÄÌïò", "192:Ïó≠ÏÇ¨", "147:Î∏åÎ†âÏãúÌä∏", "145:ÏûêÎèôÏ∞®", "174:Ïó¨Ìñâ", "Í¥ÄÍ¥ë", "196:Î†àÏ†∏", "144:Ïã†Ïïô", "181:Ï¢ÖÍµê", "230:Í≥ºÌïô", "111:LearningJava, 4Th", "94:ÏûêÎ∞î IO, NIO NetPrg", "50:Node.js ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç", "70:ÎßâÌûòÏóÜÏù¥Î∞∞Ïö∞ÎäîJavaÌîÑÎ°úÍ∑∏ÎûòÎ∞ç", "89:HTML5Î•º ÌôúÏö©Ìïú Î™®Î∞îÏùºÏõπÏï±", "90:1Î∂Ä.HTML5Ï£ºÏöîÍ∏∞Îä•", "91:2Î∂Ä. jQueryMobile", "92:3Î∂Ä.Sencha Touch", "5:Ïõπ ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç", "127:Î™®Î∞îÏùº ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç", "130:Î™®ÎçòÏõπÏùÑÏúÑÌïúHTML5ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç", "35:Ïó∞Ïòà, ÏóîÌÑ∞, Ïû¨ÎØ∏", "129:Ìï¥Ïô∏ÏßÅÍµ¨", "32:ÏáºÌïë", "135:Î¨∏Ìôî, ÏòàÏà†", "3:ÏùåÏïÖ", "139:ÎØ∏Ïà†", "49:ÏòÅÌôî", "6:Ïó∞Ïòà", "8:Ï±Ö", "211:ÍµêÏñë", "212:Îã§ÌÅê", "213:ÍµêÏú°", "46:Î≥¥Ïïà", "24:Ìå®ÏÖò", "37:Î∑∞Ìã∞", "19:ÎîîÏûêÏù∏", "114:Î©îÎ•¥Ïä§", "25:ÏÉùÌôú", "10:Ïä§Ìè¨Ï∏†", "30:ÎèôÏòÅÏÉÅ", "69:ÏõîÎÇ®Ï†Ñ", "43:ÏòÅÍ∞êÏùò Ïãú", "126:Ï≤úÍµ≠Í≥ºÏßÄÏò•", "125:Ï†ïÎ™ÖÏÑùÏÑ†ÏÉùÎãò", "137:ÌîÑÎ°úÍ∑∏Îû®", "45:CSS", "87:Eclipse", "247:easyui", "93:Google", "44:HTML", "27:JavaScript", "26:Java", "42:jQuery", "248:NetBeans", "112:Node.js", "86:Spring", "246:Mybatis", "115:Swing", "39:Thymeleaf", "254:tomcat", "113:Software", "36:ÎìúÎùºÏù¥Î≤Ñ", "257:Freemarker", "133:Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§", "41:Oracle", "48:MSSQL", "40:MySQL", "134:Ïö¥ÏòÅÏ≤¥Ï†ú", "22:Windows", "21:Unix, Linux", "175:Î†àÏò§ÏÇ¨ÏßÑ", "233:Í¥ëÍ≥†"
		);
		categoryListComboBox.setPromptText("Please select one");

		HBox nidSesBox = new HBox(nidSesTxt, nidSesTa, categoryListComboBox);

		VBox nidBox = new VBox(nidAutBox, nidSesBox, saveBtn);

		VBox saveBtnBox = new VBox(saveBtn);
		saveBtnBox.setAlignment(Pos.CENTER);

		VBox vBox = new VBox(urlHBox, webView, vSeparator, nidBox, saveBtnBox);
//		VBox vBox = new VBox(urlTf, webView, separator, saveBtn);
//		vBox.autosize();
		vBox.setAlignment(Pos.TOP_LEFT);
		Scene scene = new Scene(vBox, 1300, 800);
		primaryStage.setScene(scene);

		primaryStage.show();

	}

	public void saveHtml(String contentHtml, String title) {
		String strUrl = "https://finance.daum.net/domestic/all_quotes";
		SimpleDateFormat sdf = new SimpleDateFormat("[yyyy-MM-dd]", Locale.KOREAN);
		String strYmd = sdf.format(new Date());
		SimpleDateFormat sdf2 = new SimpleDateFormat("[yyyy-MM-dd_hhmmss]", Locale.KOREAN);
		String strYmdhms = sdf2.format(new Date());

		Document doc = Jsoup.parse(contentHtml);
		Elements marketEls = doc.select(".marketPrice .tabW ul li a");
		String market_ko = "";
		String market_en = "";
		for (Element marketEl : marketEls) {
			String marketClass = marketEl.attr("class");
			if (marketClass.equals("on")) {
				market_ko = marketEl.attr("title");
			}
		}
		System.out.println("market" + ":" + market_ko);
		if (market_ko.equals("ÏΩîÏä§Ìîº")) {
			market_en = "kospi";
		} else {
			market_en = "kosdaq";
		}
		Elements tableEls = doc.select("table");
		System.out.println("tableEls.size:" + tableEls.size());
		int stockCount = 0;
		int fundCount = 0;
		int preferredStockCount = 0;
		Map stockMap = new HashMap<>();
		for (Element tableEl : tableEls) {
			Elements trEls = tableEl.select("tr");
			for (Element trEl : trEls) {

				Elements tdEls = trEl.select("td");
				int tdCnt = 0;
				for (Element tdEl : tdEls) {
					logger.debug("tdEl:" + tdEl);
					if (tdCnt == 0) {
						Elements aEls = tdEl.select("a");
						if (aEls.size() >= 0) {
							Element firstAEl = aEls.first();
							System.out.println("firstAEl:" + firstAEl);
							if (firstAEl != null) {
								String strStockName = firstAEl.text();
								String onclick = firstAEl.attr("onclick");
								String strStockCode = onclick.substring(onclick.lastIndexOf("/") + 1);
								strStockCode = strStockCode.replace("'", "");
								if (strStockCode.startsWith("A")) {
									if (!strStockName.startsWith("ARIRANG")
										&& !strStockName.startsWith("KINDEX")
										&& !strStockName.startsWith("TIGER")
										&& !strStockName.startsWith("KBSTAR")
										&& !strStockName.startsWith("SMART")
										&& !strStockName.startsWith("KODEX")
										&& !strStockName.startsWith("TREX")
										&& !strStockName.startsWith("HANARO")
										&& !strStockName.startsWith("KOSEF")
										&& !strStockName.contains("ÏΩîÏä§Ìîº")
										&& !strStockName.contains("Î†àÎ≤ÑÎ¶¨ÏßÄ")
										&& !strStockName.contains("S&P")
										&& !strStockName.contains("ÎßàÏù¥Îã§Ïä§")
										&& !strStockName.contains("Í≥†Î∞∞Îãπ")
										&& !strStockName.contains("FOCUS")) {

										stockCount++;
										strStockCode = strStockCode.replace("A", "");
										System.out.println(strStockCode + "\t" + strStockName);
										stockMap.put(strStockCode, strStockName);
									}
								} else {
									fundCount++;
								}
								if (strStockCode.toLowerCase().contains("k")) {
//								System.out.println("Ïö∞ÏÑ†Ï£º "+strStockCode+"(" + strStockName+")");
									System.out.println("Ïö∞ÏÑ†Ï£º " + strStockName + "(" + strStockCode + ")");
									preferredStockCount++;
								}
							}

						}
					}

					if (tdCnt == 1) {
						String curPrice = tdEl.text();
						curPrice = curPrice.replace(",", "");
						int iCurPrice = Integer.parseInt(curPrice);
					}
					//specialLetter ‚Üë‚Üì ‚ñ≤ ‚ñº -
					if (tdCnt == 2) {
						String specialLetter = tdEl.select("i").text();
						tdEl.select("i").remove();
						String varyPrice = StringUtils.defaultIfEmpty(tdEl.text(), "0");
						logger.debug("varyPrice1:" + varyPrice);
						varyPrice = varyPrice.replace(",", "");
						logger.debug("varyPrice2:" + varyPrice);
						int iVaryPrice = Integer.parseInt(varyPrice);
					}
					if (tdCnt == 3) {
						String varyRatio = tdEl.text();
						logger.debug("varyRatio:" + varyRatio);
						varyRatio = varyRatio.replace("%", "");
						float fVaryRatio = Float.parseFloat(varyRatio);
					}
					tdCnt++;
				}
			}

		}
		System.out.println("stockCount:" + stockCount);
		System.out.println("fundCount:" + fundCount);
		System.out.println("preferredStockCount:" + preferredStockCount);
		System.out.println("stockCount- preferredStockCount:" + (stockCount - preferredStockCount));
		System.out.println("stockMap.size:" + stockMap.size());
		StringBuilder stockCodeNameSb = new StringBuilder();
		Set keySet = stockMap.keySet();
		Iterator it = keySet.iterator();
		while (it.hasNext()) {
			String strStockCode = (String) it.next();
			String strStockName = (String) stockMap.get(strStockCode);
			stockCodeNameSb.append(strStockCode + "\t" + strStockName + "\r\n");
		}
		//String jsonArray = JSONArray.toJSONString(stockVoList);
		//jsonArray=list
		List<Map> stockMapList = new ArrayList<>();
		stockMapList.add(stockMap);
//		String jsonArray = JSONArray.toJSONString(stockMapList);
		String jsonArray = stockMapList.toArray().toString();
		//jsonObject=map
//		String jsonObject = JSONObject.toJSONString(stockMap);
		String jsonObject = stockMap.toString();
		String fileName = "";
//		fileName = userHome + "\\documents\\" + strYmdhms + "_" + market_en + "_list.json";
		fileName = market_en + "_list.json";
		FileUtil.fileWrite(fileName, jsonObject);
//		fileName = userHome + "\\documents\\" + strYmdhms + "_" + market_en + "_list.txt";
		fileName = market_en + "_list.txt";
		FileUtil.fileWrite(fileName, stockCodeNameSb.toString());
		JOptionPane.showMessageDialog(null, "Ï£ºÏãù Î™©Î°ùÏùÑ Ï∂îÏ∂úÌïòÏòÄÏäµÎãàÎã§.");
	}

	private void saveCookies() throws NoSuchMethodException, InvocationTargetException, IllegalAccessException, NoSuchFieldException, ClassNotFoundException, IOException {
		CookieManager cookieManager = (CookieManager) CookieHandler.getDefault();
		Field f = cookieManager.getClass().getDeclaredField("store");
		f.setAccessible(true);
		Object cookieStore = f.get(cookieManager);

		Class cookieClass = Class.forName("com.sun.webkit.network.Cookie");
		System.out.println("cookieClass:" + cookieClass);

		Field bucketsField = Class.forName("com.sun.webkit.network.CookieStore").getDeclaredField("buckets");
		bucketsField.setAccessible(true);
		Map buckets = (Map) bucketsField.get(cookieStore);
		System.out.println("buckets:" + buckets);
		f.setAccessible(true);
		Map<String, Collection> cookiesToSave = new HashMap<>();
		for (Object o : buckets.entrySet()) {
			Map.Entry pair = (Map.Entry) o;
			String key = (String) pair.getKey();
			Map cookies = (Map) pair.getValue();
			cookiesToSave.put(key, cookies.values());
		}

		Gson gson = new GsonBuilder().create();
		String json = gson.toJson(cookiesToSave);
		System.out.println("json:" + json);
		JSONObject jo = new JSONObject(json);
		callJsonObjectLoop(jo);
		System.out.println("strNidAut:" + strNidAut);
		System.out.println("strNidSes:" + strNidSes);
		nidAutTf.setText(strNidAut);
		nidSesTa.setText(strNidSes);
		Files.write(Paths.get("cookies.json"), json.getBytes());
	}

	private void getNaverCookies() {
		try {
			CookieManager cookieManager = (CookieManager) CookieHandler.getDefault();
			System.out.println("cookieManager:" + cookieManager);
			System.out.println("cookieManager.getClass():" + cookieManager.getClass());
			Field f = cookieManager.getClass().getDeclaredField("store");
			f.setAccessible(true);
			Object cookieStore = f.get(cookieManager);

			Class cookieClass = Class.forName("com.sun.webkit.network.Cookie");
			System.out.println("cookieClass:" + cookieClass);

			Field bucketsField = Class.forName("com.sun.webkit.network.CookieStore").getDeclaredField("buckets");
			bucketsField.setAccessible(true);
			Map buckets = (Map) bucketsField.get(cookieStore);
			System.out.println("buckets:" + buckets);
			f.setAccessible(true);
			Map<String, Collection> cookiesToSave = new HashMap<>();
			for (Object o : buckets.entrySet()) {
				Map.Entry pair = (Map.Entry) o;
				String key = (String) pair.getKey();
				Map cookies = (Map) pair.getValue();
				cookiesToSave.put(key, cookies.values());
			}

			Gson gson = new GsonBuilder().create();
			String json = gson.toJson(cookiesToSave);
			System.out.println("json:" + json);
			JSONObject jo = new JSONObject(json);
			callJsonObjectLoop(jo);
			System.out.println("strNidAut:" + strNidAut);
			System.out.println("strNidSes:" + strNidSes);
			nidAutTf.setText(strNidAut);
			nidSesTa.setText(strNidSes);
		} catch (NoSuchFieldException ex) {
			java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
		} catch (SecurityException ex) {
			java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
		} catch (IllegalArgumentException ex) {
			java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
		} catch (IllegalAccessException ex) {
			java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
		} catch (ClassNotFoundException ex) {
			java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
		}
	}

	public void callJsonObjectLoop(Object obj) {
		if (obj instanceof JSONObject) {
			JSONObject jObj = (JSONObject) obj;
			Iterator keysIt = jObj.keys();
			while (keysIt.hasNext()) {
				String key = (String) keysIt.next();
				Object value = jObj.get(key);
				System.out.println(key + ":" + value.toString());
				if (value.toString().equals("NID_SES")) {
					strNidSes = (String) jObj.get("value");
					System.out.println("strNidSes:" + strNidSes);
				} else if (value.toString().equals("NID_AUT")) {
					strNidAut = (String) jObj.get("value");
					System.out.println("strNidAut:" + strNidAut);
				}
				if (value instanceof JSONObject) {
					callJsonObjectLoop((JSONObject) value);
				} else if (value instanceof JSONArray) {
					callJsonObjectLoop((JSONArray) value);
				}
			}
		} else if (obj instanceof JSONArray) {
			JSONArray jAry = (JSONArray) obj;
			for (int i = 0; i < jAry.length(); i++) {
				JSONObject jObj = (JSONObject) jAry.get(i);
				System.out.println("jObj:" + jObj.toString());
				callJsonObjectLoop(jObj);
			}
		}
	}

	private void createHTMLFile(String url) {
		if (url.equals("")) {
			return;
		}
		System.out.println("createHTMLFile url:" + url);
		// tab2ÏóêÏÑú ÌéòÏù¥ÏßÄ Ïù¥Îèô
		int idx = 0;
		String newsCompany = "";
		for (NewsPublisher np : NewsPublisher.values()) {
			String newsPublisherDomain = np.getName();
			idx = np.ordinal();
			if (url.contains(newsPublisherDomain)) {
				System.out.println("idx:" + idx + " newsPublisherDomain:" + newsPublisherDomain);
				System.out.println("Ï£ºÏÜåÍ∞Ä ÏùºÏπòÌï©ÎãàÎã§. idx:" + idx);
				newsCompany = np.toString();
				System.out.println("newsCompany:" + newsCompany);
				break;
			}
		}
		StringBuilder sb = new StringBuilder();

		if (newsCompany.equals("")) {
			shareResultTxt.setText("Îâ¥Ïä§ ÌÅ¥ÎûòÏä§ Î∂ÄÏû¨");
			return;
		}

		Class<?> c;
		try {
			c = Class.forName("html.parsing.stock.news." + newsCompany);
			System.out.println("Class Name:" + c.getName());
			// c.getDeclaredMethods()[0].invoke(object, Object... MethodArgs );
			Method method = c.getDeclaredMethod("createHTMLFile", String.class);
			sb = (StringBuilder) method.invoke(String.class, new Object[]{url});
			java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.INFO, sb.toString());
		} catch (ClassNotFoundException | IllegalAccessException | IllegalArgumentException | InvocationTargetException
			| NoSuchMethodException | SecurityException ex) {
			java.util.logging.Logger.getLogger(JavaFxNewsReaderNaverLinkShare.class.getName()).log(Level.SEVERE, null, ex);
			return;
		}

		Document htmlDoc = Jsoup.parse(sb.toString());
		logger.debug("htmlDoc:" + htmlDoc.html());

		htmlDoc.select("meta").remove();
		sb.delete(0, sb.length());
		sb.setLength(0);

		String strCategoryNo = "33";
		String strCategoryName = "Ï¶ùÍ∂å";
		String strSelectedCategory = String.valueOf(categoryListComboBox.getSelectionModel().getSelectedItem());
		System.out.println("strSelectedCategory :" + strSelectedCategory);
		String strSelectedCategoryArray[] = strSelectedCategory.split(":");
		System.out.println("strSelectedCategoryArray.length :" + strSelectedCategoryArray.length);
		if (strSelectedCategoryArray.length > 1) {
			strCategoryNo = strSelectedCategoryArray[0];
			strCategoryName = strSelectedCategoryArray[1];
			System.out.println("strSelectedCategoryArray[0]-------------->" + strSelectedCategoryArray[0]);
			System.out.println("strSelectedCategoryArray[1]-------------->" + strSelectedCategoryArray[1]);
		}

		String strShareTitle = htmlDoc.select("h2#title").text();
		logger.debug("strShareTitle:" + strShareTitle);
		Elements shareUrlEls = htmlDoc.select("a");
		String strShareUrl = "";
		if (shareUrlEls.size() > 0) {
			strShareUrl = htmlDoc.select("a").first().attr("href");
		}
		StringBuilder contentSb = new StringBuilder();
		contentSb.append(htmlDoc.html());
		contentSb.toString();

		logger.debug("strShareUrl:" + strShareUrl);

		if (naverBlogLinkShare(contentSb, strCategoryName, strShareTitle, strShareUrl)) {
			shareResultTxt.setText("Î∏îÎ°úÍ∑∏ Í∏ÄÏì∞Í∏∞ ÏÑ±Í≥µ");
		} else {
			shareResultTxt.setText("Î∏îÎ°úÍ∑∏ Í∏ÄÏì∞Í∏∞ Ïã§Ìå®");
		}
	}

	public boolean naverBlogLinkShare(StringBuilder contentSb, String strCategoryName, String strShareTitle, String strShareUrl) {
		strNidAut = nidAutTf.getText();
		strNidSes = nidSesTa.getText();
		return NaverUtil.naverBlogLinkShare(strNidAut, strNidSes, strShareUrl, strShareTitle, strCategoryName, contentSb, null);
	}
}
